<div class="top_page">
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <%= link_to '野菜登録する', 'add_vegetables',:style=>"color:#ffffff;" %>
      </li>
    </ul>

  </div>
  <canvas id="myChart" width="400" height="400"></canvas>
  <hr>

  <% @dishes.each do |dish| %>
  <div class="checkbox-inline">
    <div>
      <%= check_box 'dish', '1', {}, true, false %>
        <h3 class="recipe_title"
            style="background-image:url('<%= dish.img_url %>')">
          <a href="http://recipe.rakuten.co.jp/recipe/<%= dish.recipe_id %>/"><%= dish.recipe_title %></a>
          (<%= dish.serving %>人分)
        </h3>
    </div>
  </div>
  <table class="table">
  <% @vegetable_stocks.to_a.each do |vegetable_stock| %>
    <% if (veg_count = dish.send(vegetable_stock[0])) != 0 then %>
    <tr data-<%= vegetable_stock[0] %>="<%= veg_count %>">
      <td><%= image_tag('veg_' + vegetable_stock[0].to_s + '.png', :size => '32x32') %></td>
      <td><%= vegetable_stock[1] %></td>
      <td><%= veg_count %> 個</td>
    </tr>
    <% end %>
  <% end %>
  </table>
  <hr>
<% end %>

<script>
var ctx = document.getElementById("myChart");
var ctx = document.getElementById("myChart").getContext("2d");
var ctx = $("#myChart");

var label_list = new Array();
var data_list = new Array();//手持ちの野菜
var will_list = new Array();//使う予定の野菜

//手持ちの野菜
<% @vegetable_stocks.to_a.each do |vegetable_stock| %>
  label_list.push('<%= vegetable_stock[1] %>');
  data_list.push('<%= vegetable_stock[2] %>');
<% end %>

//使う予定の野菜
//var message = '使う予定の野菜: ';
<% @vegetable_stocks.to_a.each do |vegetable_stock| %>
  {
    var vegs = document.querySelectorAll('[data-<%= vegetable_stock[0] %>]');
    var veg_count = 0;
    for (var i = 0; i < vegs.length; i++) {
      var veg = vegs[i];
      veg_count += parseFloat(veg.dataset.<%= vegetable_stock[0] %>);
    }

    will_list.push(veg_count);
    //message += '<%= vegetable_stock[1] %> : ' + veg_count + '個 '
  }
<% end %>
var myChart = new Chart(ctx, {
    type: 'radar',
    data: {
        labels: label_list,
        datasets: [{
            label: '手持ちの野菜',
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
            ],
            borderWidth: 1,
            data: data_list,
        },
                   {
            label: '使う予定の野菜',
            backgroundColor: [
                'rgba(153, 102, 255, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 99, 132, 0.2)'
            ],
            borderColor: [
                'rgba(153, 102, 255, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255,99,132,1)'
            ],
            borderWidth: 1,
            data: will_list,
        }
        ]
    },
    options: {

    }
});


</script>
  <!-- /container -->
